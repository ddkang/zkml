use halo2_proofs::halo2curves::{bn256::Fr, pasta::Fp};
use zkml::{
  model::ModelCircuit,
  utils::{
    loader::{load_model_msgpack, ModelMsgpack},
    proving_ipa::time_circuit_ipa,
    proving_kzg::time_circuit_kzg,
  },
};

fn main() {
  let config_fname = std::env::args().nth(1).expect("config file path");
  let inp_fname = std::env::args().nth(2).expect("input file path");
  let kzg_or_ipa = std::env::args().nth(3).expect("kzg or ipa");

  if kzg_or_ipa != "kzg" && kzg_or_ipa != "ipa" {
    panic!("Must specify kzg or ipa");
  }

  let config: ModelMsgpack = load_model_msgpack(&config_fname, &inp_fname);

  if kzg_or_ipa == "kzg" {
    let circuit = ModelCircuit::<Fr>::generate_from_file(&config_fname, &inp_fname);
    time_circuit_kzg(circuit, config);
  } else {
    let circuit = ModelCircuit::<Fp>::generate_from_file(&config_fname, &inp_fname);
    time_circuit_ipa(circuit, config);
  }
}
